<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0-beta1/dist/css/bootstrap.min.css">
    <link rel="icon" type="image/x-icon" href="../images/favicon.ico">
    <link rel="stylesheet" href="style.css">
    <script src="../js/jquery.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0-beta1/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        $(document).ready(function(){
            var globalConfinementId = 0;
            var addConfinementStatusError = $('#add-confinement-status-error');
            var addConfinementStatus = $('#add-confinement-status');
            var confirmAddConfinementStatus = $('#confirm-add-confinement-status');
            var confinedPetsTable = $('#confined-pets-table');
            var globalPetId = 0;
            var globalUserId = 0;
            var globalVetTechId = 0;
            var globalApppointmentId = 0;
            var vetTechList = $('#vet-tech-list');
            var navLink = $('.navigation');
            var clientLink = $('#client-link');
            var clientSection = $('#clients-section');
            var logout = $('#logout');
            var clientsTable = $('#clients-table')
            var petsTable = $('#pets-table');
            var searchClient = $('#search-client');
            var searchClientText = $('#search-client-text');
            var profileName = $('#profile-name');
            var initialCheckupsTable = $('#initial-check-ups-table');
            var medicalHistory = $('#medical-history');
            var wellness = $('#wellness');
            var weight = $('#weight');
            var temp = $('#temp');
            var hr = $('#hr');
            var rr = $('#rr');
            var physicalExam = $('#physical-exam');
            var ccHx = $('#cc-hx');
            var dxTools = $('#dx-tools');
            var tdx = $('#tdx');
            var treatment = $('#treatment');
            var inPatient = $('#in-patient');
            var surgery = $('#surgery');
            var outPatient = $('#out-patient');
            var takeHomeMeds = $('#take-home-meds');
            var confirmInsertMedicalRecord = $('#confirm-insert-medical-record');
            var checkupDate = $('#check-up-date');
            var wellnessRecordTable = $('#wellness-record-table');
            var appointmentsList = $('#appointment-list');
            var appointmentSection = $('#appointments-section');
            var clientsSection = $('#clients-section');
            var appointmentLink = $('#appointment-link');
            var clientLink = $('#client-link');
            var navigation = $('.navigation');
            var noAppointments = $('#no-appointments');
            var petsClientName = $('#client-name');
            var recordsPetName = $('#records-pet-name');
            var recordsClientName = $('#records-client-name');
            var chooseVetAssistant = $('#choose-vet-assistant');
            var patientOwnerName = $('#patient-owner-name');
            var patientName = $('#patient-name');
            var clientCode = $('#client-code');
            var medicalRecordWeight = $('#medical-record-weight');
            var medicalRecordTemp = $('#medical-record-temp');
            var medicalRecordHr = $('#medical-record-hr');
            var medicalRecordRR = $('#medical-record-rr');
            var medicalRecordTests = $('#medical-record-tests');
            var medicalRecordProcedures = $('#medical-record-procedures');
            var medicalRecordMedication = $('#medical-record-medication');
            var medicalRecordCaseClosed = $('#medical-record-case-closed');
            var medicalRecordNextAppointment = $('#medical-record-next-appointment');
            var medicalRecordConfirm = $('#medical-record-confirm');
            var medicalRecordRemarks = $('#medical-record-remarks');
            var medicalRecordService = $('#medical-record-service');
            var medicalRecordClientName = $('#medical-record-client-name');
            var medicalRecordClientCode = $('#medical-record-client-code');
            var medicalRecordPetName = $('#medical-record-pet-name');
            var medicalRecordsTable = $('#medical-records-table');
            var labRequest = $('#lab-request');
            var confirmLabRequest = $('#confirm-lab-request');
            var labRequestTable = $('#lab-request-table');
            var refreshLabRequests = $('#refresh-lab-requests');
            var labResultPatientName = $('#lab-result-patient-name');
            var labResultLabRequest = $('#lab-result-lab-request');
            var labResultAttendingVet = $('#lab-result-attending-vet');
            var labResultsList = $('#lab-results-list');
            var chooseVetTech = $('#choose-vet-tech');
            var timeLimit = $('#time-limit');
            var chooseVetTechDropDownIsActive = false;
            var servicesList = $('#services-list');
            var chooseService = $('#choose-service');
            var confirmService = $('#confirm-service');
            var basePrice = $('#base-price');
            var quantity = $('#quantity');
            var soaTable = $('#soa-table');
            var chooseServiceDropdownIsActive = false;
            var customService = $('#custom-service');
            var customBasePrice = $('#custom-base-price');
            var customQuantity = $('#custom-quantity');
            var confirmCustomService = $('#confirm-custom-service');
            var submitSoa = $('#submit-soa');
            var customServiceCategory = $('#custom-service-category');
            var servicesLink = $('#services-link');
            var servicesSection = $('#services-section');
            var laboratoryList = $('#laboratory-list');
            var emergencyList = $('#emergency-list');
            var surgeryList = $('#surgery-list');
            var vetLabRequestTable = $('#vet-lab-request-table');
            var labRequestLink = $('#lab-request-link');
            var labRequestSection = $('#lab-request-section');
            var serviceAttendingLabTech = $('#service-attending-lab-tech')
            var customServiceAttendingLabTech = $('#custom-service-attending-lab-tech');
            var customServiceAttendingLabTechList = $('#custom-service-attending-lab-tech-list');
            var serviceAttendingLabTechList = $('#service-attending-lab-tech-list');
            var soaDetailsTable = $('#soa-details-table');
            var clientPetsList = $('#client-pets-list');
            var insertPetName = $('#insert-pet-name');
            var insertPetBreed = $('#insert-pet-breed');
            var insertPetSpecies = $('#insert-pet-species');
            var insertPetSex = $('#insert-pet-sex');
            var insertPetBirthDate = $('#insert-pet-birth-date');
            var confirmInsertPet = $('#confirm-insert-pet');
            var confirmBook = $('#confirm-book');
            var refreshSpinner = $('#refresh-spinner');
            var confirmBookSpinner = $('#confirm-book-spinner');
            var addClientName = $('#add-client-name');
            var addClientEmail = $('#add-client-email');
            var addClientContact = $('#add-client-contact');
            var addClientCode = $('#add-client-code');
            var confirmAddClient = $('#confirm-add-client');
            var addClientCodeError = $("#add-client-code-error");
            var addCLientNameError = $('#add-client-name-error')
            var balance = $('#balance');
            var currentPasswordModal = $('#enter-current-password-modal');
            var confirmPassword = $('#confirm-password');
            var currentPassword = $('#current-password');
            var currentPasswordError = $('#current-password-error');
            var editPasswordModal = $('#edit-password-modal')
            var newPassword = $('#new-password')
            var newPasswordError = $('#new-password-error');
            var retypeNewPassword = $('#retype-new-password');
            var retypeNewPasswordError = $('#retype-new-password-error');
            var confirmNewPassword = $('#confirm-new-password');
            var doctorLabResultPatientName = $('#doctor-lab-result-patient-name');
            var doctorLabResultLabRequest = $("#doctor-lab-result-lab-request");
            var doctorLabResultAttendingVet = $("#doctor-lab-result-attending-vet");
            var doctorLabResultsList = $('#doctor-lab-results-list');
            var loadingScreen = $('#loading-screen');
            var timeLimitError = $('#time-limit-error');
            var labRequestError = $('#lab-request-error');
            var yesterdayAppointmentsList = $('#yesterday-appointment-list');
            var tomorrowAppointmentsList = $('#tomorrow-appointment-list');
            var soaClientName = $('#soa-client-name');
            var soaPatientName = $('#soa-patient-name');
            var soaClientCode = $('#soa-client-code');
            var medication = $('#medication');
            var totalAmount = $('#total-amount');
            var paymentsTable = $('#payments-table');
            var soaAttendingVet = $('#soa-attending-vet');
            var confinementLink = $('#confinement-link');
            var confinementSection = $('#confinement-section');
            var confinementCLientName = $('#confinement-client-name');
            var confinementContact = $('#confinement-contact');
            var confinementPetName = $('#confinement-pet-name');
            var confinementSpecies = $('#confinement-species');
            var confinementBreed = $('#confinement-breed');
            var confinementBirthDate = $('#confinement-birthdate');
            var confinementSex = $('#confinement-sex');
            var confinementTypeOfFluid = $('#confinement-type-of-fluid');
            var confinementDripRate = $('#confinement-drip-rate');
            var confinementDurationofFluid = $('#confinement-duration-of-fluid');
            var confinementTempDef = $('#confinement-temp-def');
            var viewConfinementDetailsModal = $('#view-confinement-details-modal');
            var confinementStatusTable = $('#confinement-status-table');


            confirmAddConfinementStatus.on('click', function(){
                if(addConfinementStatus.val() == ""){
                    addConfinementStatusError.text('Please fill out this field');
                    addConfinementStatus.addClass('is-invalid');
                }else{
                    confirmAddConfinementStatus.prop('disabled', true);
                    $.ajax({
                        type: 'POST',
                        url: 'php/addConfinementStatus.php',
                        data:{
                            confinement_id: globalConfinementId,
                            status: addConfinementStatus.val()
                        },
                        success: function(response){
                            confirmAddConfinementStatus.prop('disabled', false);
                            addConfinementStatus.val('');
                            var data = JSON.parse(response);
                            addToConfinementStatusTable(confinementStatusTable.children().length, data.status, data.date);
                        }
                    })
                }
            })

            newPassword.on('keydown', function(){
                newPassword.removeClass('is-invalid');
            })

            retypeNewPassword.on('keydown', function(){
                retypeNewPassword.removeClass('is-invalid');
            })

            confirmNewPassword.on('click', function(){
                if(newPassword.val() == ""){
                    newPasswordError.text('Please fill out this field');
                    newPassword.addClass('is-invalid');
                }else if(retypeNewPassword.val() == ""){
                    retypeNewPassword.text('Please fill out this field');
                    retypeNewPassword.addClass('is-invalid');
                }else if(newPassword.val() != retypeNewPassword.val()){
                    retypeNewPassword.addClass('is-invalid');
                    retypeNewPasswordError.text('Password Mismatch');
                }else{  
                    confirmNewPassword.text('Updating')
                    confirmNewPassword.prop('disabled', true);
                    $.ajax({
                        type: 'POST',
                        url: 'php/updatePassword.php',
                        data:{
                            password: newPassword.val(),
                        },
                        success: function(response){
                            confirmNewPassword.prop('disabled', false);
                            confirmNewPassword.text('Confirm');
                            if(response == 'ok'){
                                alert('Password has been updated successfully.');
                                newPassword.val('')
                                retypeNewPassword.val('')
                                editPasswordModal.modal('hide');
                            }else{
                                alert('Session expired. Please log in to continue.');

                                window.location.replace('index.html');
                            }
                        }
                    })
                }
            })


            currentPassword.on('keydown', function(){
                currentPassword.removeClass('is-invalid');
                currentPasswordError.text('Please fill out this field');
            })
            confirmPassword.on('click', function(){
                if(currentPassword.val() == ""){
                    currentPassword.addClass('is-invalid');
                }else{
                    confirmPassword.prop('disabled', true);
                    confirmPassword.text('Please Wait');
                    $.ajax({
                        type: 'POST',
                        url: 'php/verifyPassword.php',
                        data:{
                            password: currentPassword.val(),
                        },
                        success: function(response){
                            confirmPassword.prop('disabled', false);
                            confirmPassword.text('Confirm');

                            if(response == 'ok'){
                                currentPasswordModal.modal('hide')
                                currentPassword.val('');

                                editPasswordModal.modal('show');
                            }else if(response == 'session expired'){
                                alert('Session expired. Please log in to continue.');
                                window.location.replace('index.html');
                            }else{
                                currentPassword.addClass('is-invalid');
                                currentPasswordError.text('Invalid Password');
                            }
                        }
                    })
                }
            })
            
            addClientCode.on('keydown', function(){
                addClientCode.removeClass('is-invalid');
            })
            addClientName.on('keydown', function(){
                addClientName.removeClass('is-invalid');
            })
            confirmAddClient.on('click', function(){
                if(addClientCode.val() == ""){
                    addClientCode.addClass('is-invalid');
                    addCLientCodeError.text('Please fill out this field');
                }else if(addClientName.val() == ""){
                    addClientName.addClass('is-invalid');
                    addCLientNameError.text('Please fill out this field');
                }else{
                    $.ajax({
                        type: 'POST',
                        url: 'php/addClient.php',
                        data:{
                            name: addClientName.val(),
                            email: addClientEmail.val(),
                            code: addClientCode.val(),
                            contact: addClientContact.val()
                        },
                        success: function(response){
                            if(response != 'client code already exists'){
                                alert('Client added successfully');
                                var data = JSON.parse(response);
                                addToClientsTable(clientsTable.children().length, data.attending_vet, data.contact_no, data.name, data.client_code, data.id)
                                addClientName.val('');
                                addClientEmail.val('');
                                addClientContact.val('');
                                addClientCode.val('');
                                $('#add-client-modal').modal('hide');
                            }else{
                                addClientCode.addClass('is-invalid');
                                addClientCodeError.text('This client code already exists.');
                            }
                            
                        }
                    })
                }
            })

            confirmBookSpinner.hide();
            refreshSpinner.hide();




            confirmBook.on('click', function(){
                var petIds = [];
                var checked = 0;
                $(clientPetsList.children()).each(function(index){
                    if($(this).find('input').prop('checked') == true){
                        petIds.push($(this).find('.form-check').children().eq(2).val())
                    }
                })

                if(petIds.length == 0){
                    alert('Please choose atleast one pet.');
                }else{
                    confirmBook.prop('disabled', true);
                    confirmBookSpinner.show();
                    $.ajax({
                        type: 'POST',
                        url: 'php/bookAppointment.php',
                        data:{
                            pet_ids: petIds,
                            user_id: globalUserId
                        },
                        success: function(response){
                            confirmBook.prop('disabled', false);
                            confirmBookSpinner.hide();
                            if(response == 'ok'){
                                alert('Successfully Booked! Please proceed to Appointments Tab to view recently booked appointment.');
                                $('#client-booking-modal').modal('hide');
                            }
                        }
                    })
                }
                
            })

            confirmInsertPet.on('click', function(){
                if(confirm("Confirm?") == true){
                    $.ajax({
                        type: 'POST',
                        url: 'php/addNewPet.php',
                        data:{
                            name: insertPetName.val(),
                            breed: insertPetBreed.val(),
                            species: insertPetSpecies.val(),
                            sex: insertPetSex.val(),
                            birth_date: insertPetBirthDate.val(),
                            user_id: globalUserId
                        },
                        success: function(response){
                            var data = JSON.parse(response);
                            addToPetsTable(petsTable.children().length , data.pet_id, data.name, data.breed, data.species, data.sex, data.age);
                            insertPetName.val('')
                            insertPetBreed.val('')
                            insertPetSpecies.val('')
                            insertPetBirthDate.val('')
                        }
                    })
                }
            })

            serviceAttendingLabTechList.val('0');


            serviceAttendingLabTech.on('click', function(){
                serviceAttendingLabTechList.children().remove();
                $.ajax({
                    type: 'GET',
                    url: 'php/getVetTechnicians.php',
                    success: function(response){
                        var data = JSON.parse(response);
                        $(data).each(function(index, value){
                            serviceAttendingLabTechList.append(`<li><button value="${value.id}" class="service-lab-tech dropdown-item">${value.name}</button></li>`);
                            var serviceLabTech = serviceAttendingLabTechList.children().eq(index).find('.service-lab-tech');

                            serviceLabTech.on('click', function(){

                                serviceAttendingLabTech.text($(this).text());
                                serviceAttendingLabTech.val($(this).val());
                            })
                        })
                    }
                })
            })

            customServiceAttendingLabTech.on('click', function(){
                customServiceAttendingLabTechList.children().remove();
                $.ajax({
                    type: 'GET',
                    url: 'php/getVetTechnicians.php',
                    success: function(response){
                        var data = JSON.parse(response);
                        $(data).each(function(index, value){
                            customServiceAttendingLabTechList.append(`<li><button value="${value.id}" class="custom-service-lab-tech dropdown-item">${value.name}</button></li>`);
                            var customServiceLabTech = customServiceAttendingLabTechList.children().eq(index).find('.custom-service-lab-tech');

                            customServiceLabTech.on('click', function(){

                                customServiceAttendingLabTech.text($(this).text());
                                customServiceAttendingLabTech.val($(this).val());
                            })
                        })
                    }
                })
            })


            var serviceCategories = [];
            var soaServices = [];
            var soaBasePrices = [];
            var soaTotalPrices = [];
            var soaQuantities = [];
            var soaDiscounts = [];
            var soalabTechIds = [];


            submitSoa.on('click', function(){

                if(confirm("Confirm Submission of Statement of Accounts? Consider reviewing the details first.") == true){
                    $.ajax({
                        type: 'POST',
                        url: 'php/submitSoa.php',
                        data:{
                            pet_id: globalPetId,
                            lab_tech_ids: soalabTechIds,
                            services: soaServices,
                            base_prices: soaBasePrices,
                            total_prices: soaTotalPrices,
                            quantities: soaQuantities,
                            discounts: soaDiscounts,
                            categories: serviceCategories,
                        },
                        success: function(response){              
                            if(response == 'ok'){
                                alert('Statement of Accounts has been successfully submitted.');
                                soaTable.children().remove();
                                clearSoa();
                            }
                        }
                    })
                }
                
            })


            function clearSoa(){
                soaServices = [];
                soaBasePrices = [];
                soaTotalPrices = [];
                soaQuantities = [];
                soaDiscounts = [];
                serviceCategories = [];
                soalabTechIds = [];
            }

            confirmCustomService.on('click', function(){
                if(customService.val() == ""){
                    customService.addClass('is-invalid');
                }else if(customBasePrice.val() == ""){
                    customBasePrice.addClass('is-invalid');
                }else if(customQuantity.val() == ""){
                    customQuantity.addClass('is-invalid');
                }else{
                    var total = parseFloat(customBasePrice.val()) * parseFloat(customQuantity.val());
                    var index = soaTable.children().length;
                    if(customServiceAttendingLabTech.val() == ""){
                        customServiceAttendingLabTech.va(0);
                    }
                    addToSoaTable(index, customServiceAttendingLabTech.val(), customService.val(), customBasePrice.val(), customQuantity.val(), total);

                    serviceCategories.push(customServiceCategory.val());
                    customServiceAttendingLabTech.text('Choose Attending Vet Tech')
                    customServiceAttendingLabTech.val(0);
                    customBasePrice.val('');
                    customQuantity.val('')
                    customService.val('');
                }
            })

            confirmService.on('click', function(){
                if(chooseService.text() == "Choose Service"){
                    alert('Please choose a service.');
                }else if(basePrice.val() == ""){
                    basePrice.addClass('is-invalid');
                }else if(quantity.val() == ""){
                    quantity.addClass('is-invalid');
                }else{
                    var total = parseFloat(basePrice.val()) * parseFloat(quantity.val());
                    var index = soaTable.children().length;

                    if(serviceAttendingLabTech.val() == ""){
                        serviceAttendingLabTech.val(0);
                    }
                    addToSoaTable(index, serviceAttendingLabTech.val(), chooseService.text(), basePrice.val(), quantity.val(), total);
                    serviceCategories.push(chooseService.val());
                    basePrice.val('');
                    quantity.val('')
                    serviceAttendingLabTech.val(0);
                    serviceAttendingLabTech.text('Choose Attending Vet Tech')
                    chooseService.text('Choose Service')
                }
            })

            function addToSoaTable(index, labtechId, service, basePrice, quantity, total){
                soaServices.push(service)
                soaBasePrices.push(basePrice);
                soaQuantities.push(quantity);
                soaTotalPrices.push(total);
                soaDiscounts.push(0);
                soalabTechIds.push(labtechId);
                soaTable.append(`<tr>
                                    <td>${service}</td>
                                    <td>&#8369 ${basePrice}</td>
                                    <td>${quantity}</td>
                                    <td>&#8369 <span class="total-price">${total}</span></td>
                                    <td>
                                        <input type="number" class="form-control discount" value=0>
                                    </td>
                                </tr>`)
                var discount = soaTable.children().eq(index).find('.discount');
                var totalPrice = soaTable.children().eq(index).find('.total-price');
                discount.on('change', function(){
                    var thisDiscount = $(this);
                    var rate = thisDiscount.val()

                    if(rate == ""){
                        thisDiscount.val(0);
                        rate = 0;
                    }
                    var percentage = parseFloat(parseFloat(rate) / parseFloat(100) * total);
                    var discountedPrice = parseFloat(total - percentage);
                    totalPrice.text(discountedPrice);
                    soaDiscounts[index] = rate;
                    soaTotalPrices[index] = discountedPrice;
                })
            }

            basePrice.on('keydown', function(){
                basePrice.removeClass('is-invalid');
            })
            quantity.on('keydown', function(){
                quantity.removeClass('is-invalid');
            })

            chooseService.on('click', function(){
                chooseServiceDropdownIsActive = !chooseServiceDropdownIsActive;
                if(chooseServiceDropdownIsActive == true){
                    servicesList.children().remove();
                    $.ajax({
                        type: 'GET',
                        url: 'php/getServices.php',
                        success: function(response){
                            var data = JSON.parse(response);
                        
                            $(data).each(function(index, value){
                                addToServicesList(index, value.category, value.service)
                            })
                        }
                    })
                }
                
            })
            function addToServicesList(index, category, service){
                servicesList.append(`<li>
                                        <button value="${category}" class="service dropdown-item">${service}</button>
                                    </li>`)
                var service = servicesList.children().eq(index).find('.service');

                service.on('click', function(){
                    chooseService.val($(this).val())
                    chooseService.text($(this).text())
                })
            }

            chooseVetTech.on('click', function(){
                chooseVetTechDropDownIsActive = !chooseVetTechDropDownIsActive;
                if(chooseVetTechDropDownIsActive == true){
                    $.ajax({
                        type: 'GET',
                        url: 'php/getVetTechnicians.php',
                        success: function(response){
                            var data = JSON.parse(response);
                            vetTechList.children().remove();
                            $(data).each(function(index, value){
                                addToChooseVetTechList(index, value.id, value.name)
                            })
                        }
                    })
                }

                
            })

            function addToChooseVetTechList(index, id, name){
                vetTechList.append(`<li>
                                        <button class="vet-tech dropdown-item" value="${id}">${name}</button>
                                    </li>`)

                var vetTech = vetTechList.children().eq(index).find('.vet-tech');

                vetTech.on('click', function(){
                    globalVetTechId = $(this).val()
                    chooseVetTech.text($(this).text())
                })
            }

            refreshLabRequests.on('click', function(){
                refreshSpinner.show();
                refreshLabRequests.prop('disabled', true);
                getPetLabRequestsFunc();
            })
            labRequest.on('keydown', function(){
                labRequest.removeClass('is-invalid');
            })

            timeLimit.on('keydown', function(){
                timeLimit.removeClass('is-invalid');
            })

            confirmLabRequest.on('click', function(){
                if(labRequest.val() == ""){
                    labRequest.addClass('is-invalid');
                    labRequestError.text('Please fill out this field.');
                }else if(timeLimit.val() == ""){
                    timeLimit.addClass('is-invalid');
                    timeLimitError.text('Please fill out this field');
                }else{
                    confirmLabRequest.prop('disabled', true)
                    confirmLabRequest.text('Submitting...');
                    $.ajax({
                        type: 'POST',
                        url: 'php/sendLabRequest.php',
                        data:{
                            pet_id: globalPetId,
                            request: labRequest.val(),
                            vet_tech_id: globalVetTechId,
                            time_limit: timeLimit.val(),
                        },
                        success: function(response){
                            confirmLabRequest.prop('disabled', false)
                            confirmLabRequest.text('Submit Lab Request');
                            if(response != 0){
                                alert('Lab Request has been submitted.');
                                labRequest.val('')
                                chooseVetTech.text('Choose Vet Tech');
                                globalVetTechId = 0;
                                timeLimit.val('');
                                var data = JSON.parse(response);
                                labRequestTable.append(`<tr>
                                                            <td>${data.date}</td>
                                                            <td>${data.time_limit}</td>
                                                            <td>${data.request}</td>
                                                            <td>${data.lab_tech}</td>
                                                            <td>${data.doctor}</td>
                                                            <td>Pending</td>
                                        
                                                        </tr>`)
                            }else{
                                alert('Session Expired. Please Log in to continue.');
                            }
                        }
                    })
                }
            })


            medicalRecordConfirm.on('click', function(){
                if(confirm('Save Medical Record?') == true){
                    $.ajax({
                        type:'POST',
                        url: 'php/addMedicalRecord.php',
                        data:{
                            pet_id: globalPetId,
                            appointment_id: globalApppointmentId,
                            client_id: globalUserId,
                            weight: medicalRecordWeight.val(),
                            temp: medicalRecordTemp.val(),
                            hr: medicalRecordHr.val(),
                            rr: medicalRecordRR.val(),
                            tests: medicalRecordTests.val(),
                            procedures: medicalRecordProcedures.val(),
                            medication: medicalRecordMedication.val(),
                            case_closed: medicalRecordCaseClosed.val(),
                            next_appointment: medicalRecordNextAppointment.val(),
                            vet_nurse: chooseVetAssistant.val(),
                            remarks: medicalRecordRemarks.val(),
                            service: medicalRecordService.val()
                        },
                        success: function(response){
                            if(response == 'ok'){
                                alert('Medical Record has been successfully added.')
                                $('#create-patient-records-modal').find('input').val('');
                                $('#create-patient-records-modal').find('textarea').val('');
                                var newPatientName = patientName.text();
                                newPatientName = newPatientName.replace(" (no medical record inputted)","");
                                patientName.text(newPatientName);
                            }
                        }
                    })
                }
            })


            chooseVetAssistant.on('focus', function(){
                $(this).children().remove();
                $.ajax({
                    type: 'GET',
                    url: 'php/getVetNurses.php',
                    success: function(response){
                        var data = JSON.parse(response);
                        $(data).each(function(index, value){
                            chooseVetAssistant.append(`<option value="${value.name}">${value.name}</option>`)
                        })
                    }
                })
            })
            function getAppointments(){
                loadingScreen.show()
                appointmentsList.children().remove();
                yesterdayAppointmentsList.children().remove();
                tomorrowAppointmentsList.children().remove();
                $.ajax({
                    type: 'GET',
                    url: 'php/getAppointments.php',
                    success: function(response){
                        loadingScreen.hide();
                        var data = JSON.parse(response);
                        $(data).each(function(index, value){
                            noAppointments.hide();
                            addToAppointmentsList(index, value.day, value.appointment_id, value.client_name, value.date, value.time, value.pets,value.concern,value.is_done);
                        })
                    }
                })
            }



            function addToAppointmentsList(index, day, id, clientName, date, time, pets,concern, isDone){
                var thisConcern = "";
                if(concern == ""){
                    thisConcern = "not indicated"
                }else{
                    thisConcern = concern;
                }
                if(day == "today"){
                    appointmentsList.append(`<div class="card shadow rounded-4 mt-3">
                                            <div class="card-header">
                                                <h3 class="fw-bold">${clientName}</h3>
                                                <p><em>${date} ${time}</em></p>
                                                <p><em>Concern: ${thisConcern}</em></p>
                                            </div>
                                            <div class="card-body appointment-card">
                                                <h4 class="fw-bold">Pets</h4>
                                                <hr>
                                                <div class="pets-list mt-3">
                                                    
                                                </div>
                                            </div>
                                            <div class="card-footer">
                                                <button value="${id}" class="mark-as-done btn btn-outline-primary">Mark As Done</button>
                                                <button value="${id}" class="mark-as-undone btn btn-outline-primary">Mark As Undone</button>
                                            </div>
                                        </div>`)
                    var petsList = appointmentsList.children().eq(appointmentsList.children().length - 1).find('.pets-list');
                    var markAsDone = appointmentsList.children().eq(appointmentsList.children().length - 1).find('.mark-as-done');
                    var markAsUnDone = appointmentsList.children().eq(appointmentsList.children().length - 1).find('.mark-as-undone');
                    var appointmentCard = appointmentsList.children().eq(appointmentsList.children().length - 1).find('.appointment-card');
                    if(isDone == "yes"){
                        appointmentCard.attr("style", "background-color: #d2ffd2");
                        markAsUnDone.show()
                        markAsDone.hide()
                    }else{
                        markAsDone.show()
                        markAsUnDone.hide()
                    }


                    markAsUnDone.on('click', function(){
                        var appointmentId = $(this).val();
                        if(confirm('Mark this appointment as not done?') == true){
                            $.ajax({
                                type: 'POST',
                                url: 'php/markAppointmentAsDone.php',
                                data:{
                                    appointment_id: appointmentId,
                                    is_done: 'no'
                                },
                                success: function(response){
                                    if(response == 'ok'){
                                        markAsDone.show()
                                        markAsUnDone.hide()
                                        appointmentCard.removeAttr('style');
                                    }
                                }
                            })
                        }
                    });
                    markAsDone.on('click', function(){
                        var appointmentId = $(this).val();
                        
                        if(confirm('Mark this appointment as done?') == true){
                            $.ajax({
                                type: 'POST',
                                url: 'php/markAppointmentAsDone.php',
                                data:{
                                    appointment_id: appointmentId,
                                    is_done: 'yes'
                                },
                                success: function(response){
                                    if(response == 'ok'){
                                        markAsDone.hide()
                                        markAsUnDone.show()
                                        appointmentCard.attr("style", "background-color: #d2ffd2");
                                    }
                                }
                            })
                        }
                    })
                    $(pets).each(function(index, value){
                        petsList.append(`<div class="card shadow rounded-4 mb-3">
                                            <div class="card-body d-flex justify-content-between">
                                                <h5 class="fw-bold align-self-center">${value.name}</h5>
                                                <div>
                                                    <button value="${value.id}*${id}" class="services btn btn-primary" data-bs-toggle="modal" data-bs-target="#create-patient-records-modal">Services</button>
                                                    <button value="${value.id}" class="confine btn btn-outline-primary">Subject for Confinement</button>
                                                </div>
                                            </div>
                                        </div>`)

                        var services = petsList.children().eq(index).find('.services');
                        var confine = petsList.children().eq(index).find('.confine');


                        confine.on('click', function(){
                            var thisConfineBUtton = $(this);
                            if(confirm("Subject this pet for confinement?") == true){
                                thisConfineBUtton.prop('disabled', true);

                                var confinementPetId = $(this).val();
                                $.ajax({
                                    type: 'POST',
                                    url: 'php/confine.php',
                                    data:{
                                        pet_id: confinementPetId
                                    },
                                    success: function(response){
                                        thisConfineBUtton.prop('disabled', false);
                                        if(response == 'ok'){
                                            alert("This pet has been added to Confinement data.");
                                        }else if(response = 'confinement exists'){
                                            alert("This pet is already subjected for confinement.");
                                        }else{
                                            alert("Somethin went wrong.");
                                        }
                                    }
                                })
                            }
                            
                        })
                        services.on('click', function(){
                            globalVetTechId = 0;
                            var servicesValue = $(this).val();
                            globalPetId = servicesValue.split("*")[0];
                            $.ajax({
                                type: 'POST',
                                url: 'php/getPetOwner.php',
                                data:{
                                    pet_id: servicesValue,
                                },
                                success: function(response){
                                    var data = JSON.parse(response);
                                    globalUserId = data.client_id;
                                    globalApppointmentId = data.appointment_id;
                                    patientOwnerName.text(data.name);
                                    if(data.has_medical_record == true){
                                        patientName.text(data.pet_name);
                                    }else{
                                        patientName.text(data.pet_name + " (no medical record inputted)");
                                    }
                                    
                                    clientCode.text(data.client_code);
                                }
                            })

                            getPetLabRequestsFunc();
                            
                        })
                    })
                }else if(day == "yesterday"){
                    yesterdayAppointmentsList.append(`<tr><td>${clientName}</td><td>${thisConcern}</td><td>${date} ${time}</td></tr>`)
                }else{
                    tomorrowAppointmentsList.append(`<tr><td>${clientName}</td><td>${thisConcern}</td><td>${date} ${time}</td></tr>`)
                }
                
                

                

            }

            function getPetLabRequestsFunc(){
                labRequestTable.children().remove();
                $.ajax({
                    type: 'POST',
                    url: 'php/getPetLabRequests.php',
                    data:{
                        pet_id: globalPetId
                    },
                    success: function(response){
                        refreshSpinner.hide()
                        refreshLabRequests.prop('disabled', false)
                        if(response != 0){
                            var data = JSON.parse(response);
                            $(data).each(function(index, value){
                                addToLabRequestTable(index, value.id, value.request, value.time_limit, value.lab_tech, value.doctor, value.result,value.date);
                            })
                        }
                    }
                })
            }

            function addToLabRequestTable(index,id, request,timeLimit, lab_tech, doctor, result, date){
                if(result == "Pending"){
                    labRequestTable.append(`<tr>
                                            <td>${date}</td>
                                            <td>${timeLimit}</td>
                                            <td>${request}</td>
                                            <td>${lab_tech}</td>
                                            <td>${doctor}</td>
                                            <td>${result}</td>
                                        </tr>`)
                }else{
                    labRequestTable.append(`<tr>
                                            <td>${date}</td>
                                            <td>${timeLimit}</td>
                                            <td>${request}</td>
                                            <td>${lab_tech}</td>
                                            <td>${doctor}</td>
                                            <td>
                                                <button value="${id}" class="view-results btn btn-primary" data-bs-toggle="modal" data-bs-target="#view-lab-results-modal">Results</button>
                                            </td>
                                        </tr>`)

                    var viewResults = labRequestTable.children().eq(index).find('.view-results');

                    viewResults.on('click', function(){
                        var thisViewResult = $(this);
                        labResultsList.children().remove();
                        $.ajax({
                            type: 'POST',
                            url: 'php/getLabResults.php',
                            data:{
                                lab_request_id: thisViewResult.val(),
                            },
                            success: function(response){
                                var data = JSON.parse(response)

                                labResultAttendingVet.text(data.attending_vet);
                                labResultPatientName.text(data.patient_name);
                                labResultLabRequest.text(data.request);
                                
                                $(data.results).each(function(index, value){
                                    addToLabResultsList(index, value.id, value.result)
                                })
                            }
                        })
                    })
                }
                
            }

            function addToLabResultsList(index, id, result){
                labResultsList.append(`<img style="width: 100%; height: auto;" class="img-fluid" src="../lab/php/${result}">`)
            }
            function addToDoctorLabResultsList(index, id, result){
                doctorLabResultsList.append(`<img style="width: 100%; height: auto;" class="img-fluid" src="../lab/php/${result}">`)
            }

            confirmInsertMedicalRecord.on('click', function(){
                $.ajax({
                    type: 'POST',
                    url: 'php/insertMedicalRecord.php',
                    data:{
                        pet_id: globalPetId,
                        client_id: globalUserId,
                        medical_history: medicalHistory.val(),
                        wellness_behavior: wellness.val(),
                        weight: weight.val(),
                        temp: temp.val(),
                        hr: hr.val(),
                        rr: rr.val(),
                        physical_exam: physicalExam.val(),
                        cc_hx: ccHx.val(),
                        dx_tools: dxTools.val(),
                        tdx_dx_case: tdx.val(),
                        treatment: treatment.val(),
                        in_patient: inPatient.val(),
                        surgery: surgery.val(),
                        out_patient: outPatient.val(),
                        take_home_meds: takeHomeMeds.val(),
                        date: checkupDate.val()
                    },
                    success: function(response){
                        var value = JSON.parse(response);
                        addToInitialCheckupsTable(value.id, value.medical_history, value.wellness_behavior, value.pet_weight, value.temp, value.hr, value.rr, value.physical_exam, value.cc_hx,value.dx_tools,value.tdx_dx_case,value.treatment, value.in_patient, value.surgery, value.out_patient, value.take_home_meds,value.date)
                    }
                })
            })




            searchClient.on('click', function(){
                clientsTable.children().remove();
                $.ajax({
                    type: 'POST',
                    url: 'php/searchClient.php',
                    data:{
                        keyword: searchClientText.val(),
                    },
                    success: function(response){
                        if(response != 'invalid session'){
                            var data = JSON.parse(response);
                            $(data).each(function(index, value){
                                addToClientsTable(index, value.attending_vet, value.contact_no, value.name, value.client_code, value.id);
                                if(value.banned == 1){
                                    clientsTable.children().eq(index).attr("style", "background-color: #fccccc")
                                }
                            })
                        }
                    }
                })
            })
            getClients();
            getProfile();
            appointmentSection.hide();
            servicesSection.hide();
            labRequestSection.hide();
            confinementSection.hide();

            function getClients(){
                loadingScreen.show()
                clientsTable.children().remove();
                $.ajax({
                    type: 'GET',
                    url: 'php/getClients.php',
                    success: function(response){
                        loadingScreen.hide();
                        if(response != 'invalid session'){
                            var data = JSON.parse(response);
                            $(data).each(function(index, value){
                                addToClientsTable(index, value.attending_vet, value.contact_no, value.name, value.client_code, value.id);
                                if(value.banned == 1){
                                    clientsTable.children().eq(index).attr("style", "background-color: #fccccc")
                                }
                            })
                        }else{
                            alert('Invalid Session. Please log in to continue.');
                            window.location.replace('index.html');
                        } 
                    }
                })
            }

            function getProfile(){
                $.ajax({
                    type: 'GET',
                    url: 'php/myProfile.php',
                    success: function(response){
                        var data = JSON.parse(response);
                        profileName.text("Welcome, "+ data.profile_name);
                    }
                })
            }

            function addToClientPetsList(index, value){
                clientPetsList.append(`<div class="card shadow mt-3">
                                            <div class="card-body">
                                                <div class="form-check">
                                                    <input type="checkbox" class="form-check-input">
                                                    <label class="form-check-label">${value.name}</label>
                                                    <input type="hidden" value="${value.pet_id}">
                                                </div>
                                            </div>
                                        </div>`)
            }

            function addToClientsTable(index, vet, contact, name, code, clientId){
                clientsTable.append(`<tr>
                                        <td>${name}</td>
                                        <td>${code}</td>
                                        <td>${contact}</td>
                                        <td>${vet}</td>
                                        <td class="dropdown">

                                            <button class="normal-outline-button dropdown-toggle" data-bs-toggle="dropdown">Actions</button>

                                                <ul class="dropdown-menu">
                                                    <li>
                                                        <button value="${clientId}" class="book dropdown-item" data-bs-toggle="modal" data-bs-target="#client-booking-modal">Book</button>
                                                    </li>
                                                        
                                                    <li>
                                                        <button value="${clientId}" class="view-pets dropdown-item" data-bs-toggle="modal" data-bs-target="#pets-modal">View Pets</button>
                                                    </li>
                                                </ul>
                                                
                                            
                                            
                                                
                                            
                                        </td>
                                    </tr>`)
                var viewPets = clientsTable.children().eq(index).find('.view-pets');
                var book = clientsTable.children().eq(index).find('.book');

                book.on('click', function(){
                    globalUserId = $(this).val()
                    clientPetsList.children().remove()
                    $.ajax({
                        type: 'POST',
                        url: 'php/getClientPets.php',
                        data:{
                            client_id: clientId
                        },
                        success: function(response){
                            var data = JSON.parse(response);
                            $(data.pets).each(function(index, value){
                                addToClientPetsList(index, value)
                            })
                        }
                    })
                })
                viewPets.on('click', function(){
                    globalUserId = $(this).val();
                    petsTable.children().remove();

                    $.ajax({
                        type: 'POST',
                        url: 'php/getClientPets.php',
                        data:{
                            client_id: globalUserId,
                        },
                        success: function(response){
                            if(response != 'invalid session'){
                                var data = JSON.parse(response);
                                petsClientName.text("Client Name: " + data.client_name)
                                $(data.pets).each(function(index, value){
                                    addToPetsTable(index, value.pet_id, value.name, value.breed, value.species, value.sex, value.age)
                                })
                            }else{
                                alert('Invalid Session.');
                            }
                        }
                    })
                })
            }

            function addToPetsTable(index, petId, name, breed, species, sex, age){
                petsTable.append(`<tr>
                                    <td>${name}</td>
                                    <td>${breed}</td>
                                    <td>${species}</td>
                                    <td>${sex}</td>
                                    <td>${age}</td>
                                    <td>
                                        <div class="dropdown">
                                            <button value="${petId}" class="pet-medical-records normal-outline-button dropdown-toggle" data-bs-toggle="dropdown">Actions</button>
                                            <ul class="dropdown-menu">
                                                <li>
                                                    <button value="${petId}" class="dropdown-item view-initial-checkup" data-bs-toggle="modal" data-bs-target="#wellness-record-modal">View Previous Records</button>
                                                </li>
                                                <li>
                                                    <button value="${petId}" class="view-medical-records dropdown-item" data-bs-toggle="modal" data-bs-target="#view-medical-records-modal">View Patient Medical Records</button>
                                                </li>
                                            </ul>
                                        </div>
                                    </td>
                                </tr>`);

                var viewInitalCheckup = petsTable.children().eq(index).find('.view-initial-checkup');
                var viewMedicalRecords = petsTable.children().eq(index).find('.view-medical-records');

                viewMedicalRecords.on('click', function(){
                    globalPetId = $(this).val();

                    medicalRecordsTable.children().remove();

                    $.ajax({
                        type: 'POST',
                        url: 'php/getMedicalRecords.php',
                        data:{
                            pet_id: globalPetId,
                        },
                        success: function(response){
                            if(response != 0){
                                var data = JSON.parse(response);
                                $(data).each(function(index, value){
                                    medicalRecordClientName.text("Client Name: " + value.client_name);
                                    medicalRecordClientCode.text("Client Code: " + value.client_code);
                                    medicalRecordPetName.text("Patient Name: " + value.pet_name)
                                    
                                    $(value.records).each(function(index, values){
                                        
                                        medicalRecordsTable.append(`<tr>
                                                                        <td>${values.pet_weight}</td>
                                                                        <td>${values.temp}</td>
                                                                        <td>${values.hr}</td>
                                                                        <td>${values.rr}</td>
                                                                        <td>${values.tests}</td>
                                                                        <td>${values.procedure}</td>
                                                                        <td>${values.medication}</td>
                                                                        <td>${values.case_closed}</td>
                                                                        <td>${values.doctor_id}</td>
                                                                        <td>${values.vet_nurse}</td>
                                                                        <td>${values.created_at}</td>
                                                                    </tr>`);
                                    })
                                })
                                
                            }else{
                                alert('Invalid Session. Please log in to continue');
                            }
                            
                        }
                    })
                })
                viewInitalCheckup.on('click', function(){
                    globalPetId = $(this).val();
                    $('#initial-checkups-modal').find('input').val('')
                    $('#initial-checkups-modal').find('textarea').val('');
                    wellnessRecordTable.children().remove();
                    $.ajax({
                        type: 'POST',
                        url: 'php/getPetWellnessRecords.php',
                        data:{
                            pet_id: globalPetId,
                        },
                        success: function(response){
                            var data = JSON.parse(response);
                            recordsPetName.text(data.pet_name);
                            recordsClientName.text(data.client_name);
                            $(data.records).each(function(index, value){
                                addToWellnessRecordTable(value.id, value.service, value.doctor, value.doctor_id, value.remarks, value.date, value.next_appointment, value.pet_weight)
                            })
                        }
                    })
                })
                var petMedicalRecords = petsTable.children().eq(index).find('.pet-medical-records');
                petMedicalRecords.on('click', function(){
                    globalPetId = $(this).val();
                })
            }

            function addToInitialCheckupsTable(id, medicalHistory, wellness, weight, temp, hr, rr, physicalExam, cchx, dxtools, tdx,treatment, inPatient, surgery, outPatient, takeHomeMeds, date){
                initialCheckupsTable.append(`<tr>
                                                <td>${medicalHistory}</td>
                                                <td>${wellness}</td>
                                                <td>${weight}</td>
                                                <td>${temp}</td>
                                                <td>${hr}</td>
                                                <td>${rr}</td>
                                                <td>${physicalExam}</td>
                                                <td>${cchx}</td>
                                                <td>${dxtools}</td>
                                                <td>${tdx}</td>
                                                <td>${treatment}</td>
                                                <td>${inPatient}</td>
                                                <td>${surgery}</td>
                                                <td>${outPatient}</td>
                                                <td>${takeHomeMeds}</td>
                                                <td>${date}</td>
                                            </tr>`)
            }


            function addToWellnessRecordTable(id, service, doctor, doctorId, remarks, date, nextAppointment, petWeight){
                wellnessRecordTable.append(`<tr>
                                                <td>${service}</td>
                                                <td>${petWeight}</td>
                                                <td>${doctor}</td>
                                                <td>${remarks}</td>
                                                <td>${date}</td>
                                                <td>${nextAppointment}</td>
                                            </tr>`)
            }
        
            logout.on('click', function(){
                $.ajax({
                    type: 'GET',
                    url: 'php/logout.php',
                    success: function(response){
                        if(response == 'index.html'){
                            window.location.replace(response);
                        }
                    }
                })
            })
            navLink.on('click', function(){
                navLink.removeClass('active');
                $(this).addClass('active');
                
            })

            labRequestLink.on('click', function(){
                labRequestSection.show();
                appointmentSection.hide();
                clientSection.hide();
                servicesSection.hide();
                confinementSection.hide();
                getVetLabRequests();
            })

            clientLink.on('click', function(){
                appointmentSection.hide();
                clientSection.show();
                servicesSection.hide();
                labRequestSection.hide();
                confinementSection.hide();
                getClients();
                getProfile();
            })

            appointmentLink.on('click', function(){
                labRequestSection.hide();
                clientSection.hide();
                appointmentSection.show()
                servicesSection.hide();
                confinementSection.hide()
                getAppointments();
            })
            servicesLink.on('click', function(){
                labRequestSection.hide();
                servicesSection.show();
                clientSection.hide();
                appointmentSection.hide()
                getRenderedServices();
                laboratoryList.children().remove();
                emergencyList.children().remove();
                surgeryList.children().remove();
                confinementSection.hide();
            })

            confinementLink.on('click', function(){
                labRequestSection.hide();
                servicesSection.hide();
                clientSection.hide();
                appointmentSection.hide()
                confinementSection.show();

                getConfinedPets();
            })

            function getConfinedPets(){
                confinedPetsTable.children().remove();
                loadingScreen.show();
                $.ajax({
                    type: 'GET',
                    url: 'php/confinedPets.php',
                    success: function(response){
                        loadingScreen.hide();
                        var data = JSON.parse(response);

                        $(data).each(function(index, value){
                            addToConfinementTable(index, value.name, value.id);
                        })
                    }
                })
            }

            function addToConfinementTable(index, name, id){
                confinedPetsTable.append(`<tr>
                                            <td>${name}</td>
                                            <td>
                                                <button value="${id}" data-bs-toggle="modal" data-bs-target="#view-confinement-details-modal" class="view-confinement-details normal-outline-button">View Details</button>
                                            </td>
                                        </tr>`)
                var viewConfinementDetails = confinedPetsTable.children().eq(index).find('.view-confinement-details');

                viewConfinementDetails.on('click', function(){
                    confinementStatusTable.children().remove();
                    //viewConfinementDetailsModal.children().find('span').text('');
                    var thisConfinementId = $(this).val();
                    globalConfinementId = thisConfinementId;
                    $.ajax({
                        type: 'POST',
                        url: 'php/confinementDetails.php',
                        data:{
                            confinement_id: thisConfinementId,
                        },
                        success: function(response){
                            var data = JSON.parse(response);
                            confinementCLientName.text(data.client_name);
                            confinementContact.text(data.contact_no);
                            confinementPetName.text(data.pet_name);
                            confinementSpecies.text(data.species);
                            confinementBreed.text(data.breed);
                            confinementBirthDate.text(data.date_of_birth);
                            confinementSex.text(data.sex);
                            confinementTypeOfFluid.text(data.type_of_fluid);
                            confinementDripRate.text(data.drip_rate);
                            confinementTempDef.text(data.temp_def_diagnosis);
                            confinementDurationofFluid.text(data.duration);

                            $(data.status).each(function(index, value){
                                addToConfinementStatusTable(index, value.status, value.date);
                            })
                        }
                    })
                })
            }

            function addToConfinementStatusTable(index, status, date){
                confinementStatusTable.append(`<tr><td>${status}</td><td>${date}</td></tr>`);
            }

            loadingScreen.hide();
            function getVetLabRequests(){
                loadingScreen.show();
                vetLabRequestTable.children().remove();
                $.ajax({
                    type: 'GET',
                    url: 'php/getVetLabRequests.php',
                    success: function(response){
                        loadingScreen.hide();
                        var data = JSON.parse(response);
                        $(data).each(function(index, value){
                            addToLabRequestTableWithResults(index, value.time_limit, value.id, value.patient_name, value.result, value.request, value.date);
                        })
                    }
                })
            }

            function addToLabRequestTableWithResults(index, timeLimit, id, name, result, request, requestedAt){
                if(result == "Pending"){
                    vetLabRequestTable.append(`<tr>
                                                        <td>${name}</td>
                                                        <td>${request}</td>
                                                        <td>${timeLimit}</td>
                                                        <td>${result}</td>
                                                        <td>
                                                            <div class="input-group ig-upload">
                                                                <button value="${id}" class="upload btn btn-primary"><span class="upload-spinner spinner-border spinner-border-sm text-light"></span> Upload</button>
                                                                <input class="result form-control" type="file">
                                                            </div>
                                                        </td>
                                                        <td>${requestedAt}</td>
                                                    </tr>`)
                }else{
                    vetLabRequestTable.append(`<tr>
                                                        <td>${name}</td>
                                                        <td>${request}</td>
                                                        <td>${timeLimit}</td>
                                                        <td>
                                                            <button value="${id}" class="view-results btn btn-primary" data-bs-toggle="modal" data-bs-target="#doctor-view-lab-results-modal">Results</button>
                                                        </td>
                                                        <td>
                                                            <div class="input-group ig-upload">
                                                                <button value="${id}" class="upload btn btn-primary"><span class="upload-spinner spinner-border spinner-border-sm text-light"></span> Upload</button>
                                                                <input class="result form-control" type="file">
                                                            </div>
                                                        </td>
                                                        <td>${requestedAt}</td>
                                                    </tr>`)

                    var viewResults = vetLabRequestTable.children().eq(index).find('.view-results');
                    
                    viewResults.on('click', function(){
                        var thisViewResults = $(this);
                        doctorLabResultsList.children().remove();
                        $.ajax({
                            type: 'POST',
                            url: 'php/getLabResults.php',
                            data:{
                                lab_request_id: thisViewResults.val(),
                            },
                            success: function(response){
                                doctorLabResultPatientName.text(thisViewResults.parent().parent().children().eq(0).text())
                                doctorLabResultLabRequest.text(thisViewResults.parent().parent().children().eq(1).text())
                                doctorLabResultAttendingVet.text(thisViewResults.parent().parent().children().eq(2).text())
                                var data = JSON.parse(response);
                                $(data.results).each(function(index, value){
                                    addToDoctorLabResultsList(index, value.id, value.result);
                                })
                            }
                        })
                    })
                }
                
                var result = vetLabRequestTable.children().eq(index).find('.result');
                var upload = vetLabRequestTable.children().eq(index).find('.upload')
                var uploadSpinner = vetLabRequestTable.children().eq(index).find('.upload-spinner');

                uploadSpinner.hide();
                upload.on('click', function(){
                    
                    var thisUpload = $(this);
                    var labRequestId = $(this).val();
                    if(result.val() == ""){
                        result.addClass('is-invalid');
                    }else{
                        uploadSpinner.show();
                        upload.text('Uploading...')
                        upload.prop('disabled', true);
                        var formData = new FormData();

                        formData.append("result", result[0].files[0]);
                        formData.append("lab_request_id", labRequestId);

                        $.ajax({
                            type: 'POST',
                            url: 'php/submitLabResult.php',
                            data: formData,
                            contentType: false,
                            processData: false,
                            success: function(response){
                                uploadSpinner.hide();
                                upload.prop('disabled', false)
                                upload.text('Upload');
                                if(response == 'invalid file'){
                                    alert('Please upload image files only')
                                }else{
                                    alert('Lab result has been uploaded successfully.')
                                    window.location.reload();
                                }
                            }
                        })
                    }
                })
            }
            function getRenderedServices(){
                loadingScreen.show(); 
                $.ajax({
                    type: 'GET',
                    url: 'php/getRenderredServices.php',
                    success: function(response){
                        loadingScreen.hide();
                        var data = JSON.parse(response);
                        $(data).each(function(index, value){
                            addToServicesTables(value.date, value.category, value.service, value.lab_tech, value.soa_no);
                        })
                    }
                })
            }
            // addToSoaDetailsTable(index, value.service, value.base_price, value.amount, value.quantity, value.discounted, value.discount)

            function addToSoaDetailsTable(index, service, base_price, amount, quantity, discounted, discount){
                soaDetailsTable.append(`<tr>
                                            <td>${service}</td>
                                            <td>&#8369; ${base_price}</td>
                                            <td>&#8369; ${amount}</td>
                                            <td>${quantity}</td>
                                            <td>&#8369; ${discounted}</td>
                                            <td>${discount}%</td>
                                        </tr>`)
            }

            function addToServicesTables(date, category, service, labTech, soaNo){
                if(category == "laboratory"){
                    laboratoryList.append(`<tr>
                                                <td>${date}</td>
                                                <td>${service}</td>
                                                <td>${labTech}</td>
                                                <td><button class="btn btn-link soa-number" data-bs-target="#soa-details-modal" data-bs-toggle="modal">${soaNo}</button></td>
                                            </tr>`)

                    var soaNumber = laboratoryList.children().eq(laboratoryList.children().length - 1).find('.soa-number');

                    getSoaDetails(soaNumber);
                }else if(category == "emergency"){
                    emergencyList.append(`<tr>
                                                <td>${date}</td>
                                                <td>${service}</td>
                                                <td>${labTech}</td>
                                                <td><button class="btn btn-link soa-number" data-bs-target="#soa-details-modal" data-bs-toggle="modal">${soaNo}</button></td>
                                            </tr>`)
                    
                    var soaNumber = emergencyList.children().eq(emergencyList.children().length - 1).find('.soa-number');
                    getSoaDetails(soaNumber);
                    
                }else if(category == "surgery"){
                    surgeryList.append(`<tr>
                                                <td>${date}</td>
                                                <td>${service}</td>
                                                <td>${labTech}</td>
                                                <td><button class="btn btn-link soa-number" data-bs-target="#soa-details-modal" data-bs-toggle="modal">${soaNo}</button></td>
                                            </tr>`)
                    var soaNumber = surgeryList.children().eq(surgeryList.children().length - 1).find('.soa-number');

                    getSoaDetails(soaNumber);
                }
            }

            function getSoaDetails(soaNumber){
                soaNumber.on('click', function(){
                    console.log($(this));
                    var thisSoaNumber = $(this).text();
                    soaDetailsTable.children().remove()
                    paymentsTable.children().remove()
                    $.ajax({
                        type: 'POST',
                        url: 'php/getSoa.php',
                        data:{
                            soa_number: thisSoaNumber,
                        },
                        success: function(response){
                            var data = JSON.parse(response)
                            
                            soaClientName.text(data.client_name)
                            soaPatientName.text(data.patient_name)
                            soaClientCode.text(data.client_code)
                            medication.text(data.medication)
                            totalAmount.text(data.total_amount)
                            
                            soaAttendingVet.text(data.attending_vet)
                            

                            $(data.soa).each(function(index, value){
                                addToSoaDetailsTable(index, value.service, value.base_price, value.amount, value.quantity, value.discounted, value.discount)
                            })

                            $(data.payments_history).each(function(index, value){
                                paymentsTable.append(`<tr><td>&#8369; ${value.amount_renderred}</td><td>&#8369; ${value.balance}</td></tr>`)
                            })
                        }
                    })
                })
            }
        })
    </script>
    <title>The Furr Project</title>
</head>
<body>
    <nav class="sticky-top navbar navbar-expand-xxl text-light bg navbar-dark">
        <div class="container">
            <a class="navbar-brand" href="#">
                <div class="d-lg-flex">
                    <img src="../images/thefurrproject.PNG" class="img-fluid rounded-2 shadow" style="width: 200px; height: auto">
                    <h5 class="fw-bold ms-lg-3 ms-0 mt-3 mt-lg-0 align-self-center" style="font-size: small" id="profile-name"></h5>
                </div>
                
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navMenu" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navMenu">
                <ul class="navbar-nav mb-2 mb-lg-0 ms-auto">
                    <li>
                        <button class="btn btn-light px-5 fw-bold mx-3 rounded-pill" data-bs-target="#add-client-modal" data-bs-toggle="modal" style="color: darkblue">
                            Add Client
                        </button>
                    </li>
                    <li>
                        <a id="appointment-link" class="navigation nav-link" href="#">Appointments</a>
                    </li>

                    <li>
                        <a id="confinement-link" class="navigation nav-link" href="#">Confinement</a>
                    </li>

                    <li>
                        <a href="#" id="lab-request-link" class="navigation nav-link">Lab Requests</a>
                    </li>

                    <li>
                        <a id="services-link" class="navigation nav-link" href="#">Services</a>
                    </li>
                    <li>
                        <a id="client-link" class="navigation nav-link active" href="#">Client Records</a>
                    </li>
                    <li>
                        <div class="dropdown">
                            <a class="nav-link dropdown-toggle" href="#" data-bs-toggle="dropdown">Account</a>
                            <ul class="dropdown-menu">
                                <li>
                                    <a href="#" class="dropdown-item" data-bs-toggle="modal" data-bs-target="#enter-current-password-modal">Update Profile</a>
                                </li><li>
                                    <a id="logout" href="#" class="dropdown-item">Log Out</a>
                                </li>
                            </ul>
                        </div>
                        
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="modal fade" data-bs-backdrop="static" id="add-client-modal">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <div class="modal-title">
                        <img src="../images/thefurrproject.PNG" class="img-fluid" alt="">
                    </div>
                    <button class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div>
                        <input id="add-client-name" type="text" placeholder="Name" class="form-control">
                        <div id="add-client-name-error" class="invalid-feedback">

                        </div>
                    </div>
                    
                    <input id="add-client-email" type="email" placeholder="Email" class="form-control mt-3">
                    <div>
                        <input id="add-client-code" type="text" placeholder="Client Code" class="form-control mt-3">
                        <div class="invalid-feedback" id="add-client-code-error">

                        </div>
                    </div>
                   
                    <input id="add-client-contact" type="number" placeholder="Contact Number" class="form-control mt-3">
                    <button id="confirm-add-client" class="rounded-button mt-3">Confirm</button>
                </div>
            </div>
        </div>
    </div>

    <section id="lab-request-section">
        <div class="container">
            <div class="card shadow rounded-4 mx-auto mt-5">
                <div class="card-header">
                    <h3 class="fw-bold">
                        Lab Requests
                    </h3>
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-striped">
                            <thead>
                                <th scope="col">Patient Name</th>
                                <th scope="col">Laboratory Request</th>
                                <th scope="col">Time Limit</th>
                                <th scope="col">Result</th>
                                <th scope="col">Upload Result</th>
                                <th scope="col">Requested At</th>
                            </thead>
                            <tbody id="vet-lab-request-table">

                            </tbody>
                        </table>
                        
                    </div>
                </div>
            </div>
        </div>

    </section>

    <section id="clients-section">
        <div class="container">
           
            <div class="card shadow rounded-4 col-lg-8 mx-auto mt-5">
                <div class="card-header rounded-4 d-flex justify-content-between">
                    <h3 class="fw-bold">
                        Clients
                    </h3>
                    <div class="input-group" id="search">
                        <button id="search-client" class="btn btn-outline-primary">
                            Search
                        </button>
                        <input id="search-client-text" type="text" class="form-control" placeholder="Search">
                    </div>
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-striped">
                            <thead>
                                <th scope="col">Client Name</th>
                                <th scope="col">Client Code</th>
                                <th scope="col">Contact Number</th>
                                <th scope="col">Last Appointment Attending Vet</th>
                                <th scope="col">Action</th>
                            </thead>
                            <tbody id="clients-table">

                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <section id="appointments-section">
        <div class="container">

            <div class="row row-cols-1 row-cols-xl-3 g-5">
                <div class="col col-xl-3">
                    <div class="card shadow rounded-4 mt-5">
                        <div class="card-header">
                            <h5 class="fw-bold">
                                Previous Appointments
                            </h5>
                        </div>
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table table-striped">
                                    <thead>
                                        <th scope="col">Client Name</th>
                                        <th scope="col">Concern</th>
                                        <th scope="col">Date and Time</th>
                                    </thead>
                                    <tbody id="yesterday-appointment-list">

                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col col-xl-6">
                    <div class="card shadow rounded-4 mx-auto mt-5">
                        <div class="card-header rounded-4">
                            <h3 class="fw-bold">
                                Today's Appointments
                            </h3>
                        </div>
                        <div class="card-body">
                            <div id="appointment-list">
        
                            </div>
                            <p id="no-appointments" class="lead p-5 text-center">
                                No Appointments
                            </p>
                        </div>
                    </div>
                </div>
                <div class="col col-xl-3">
                    <div class="card shadow rounded-4 mt-5">
                        <div class="card-header">
                            <h5 class="fw-bold">
                                Upcoming Appointments
                            </h5>
                        </div>
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table table-striped">
                                    <thead>
                                        <th scope="col">Client Name</th>
                                        <th scope="col">Concern</th>
                                        <th scope="col">Date and Time</th>
                                    </thead>
                                    <tbody id="tomorrow-appointment-list">

                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
        </div>
    </section>

    <section id="services-section">
        <div class="container">
            <div class="card shadow rounded-4 col-lg-7 mx-auto mt-5">
                <div class="card-header rounded-4">
                    <h3 class="fw-bold">
                        Laboratory Services
                    </h3>
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-striped">
                            <thead>
                                <th scope="col">Date</th>
                                <th scope="col">Services</th>
                                <th scope="col">Attending Vet Tech</th>
                                <th scope="col">SOA #</th>
                            </thead>
                            <tbody id="laboratory-list">

                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            <div class="card shadow rounded-4 col-lg-7 mx-auto mt-5">
                <div class="card-header rounded-4">
                    <h3 class="fw-bold">
                        Emergency Services
                    </h3>
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-striped">
                            <thead>
                                <th scope="col">Date</th>
                                <th scope="col">Services</th>
                                <th scope="col">Attending Vet Tech</th>
                                <th scope="col">SOA #</th>
                            </thead>
                            <tbody id="emergency-list">

                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            <div class="card shadow rounded-4 col-lg-7 mx-auto mt-5">
                <div class="card-header rounded-4">
                    <h3 class="fw-bold">
                        Surgery Services
                    </h3>
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-striped">
                            <thead>
                                <th scope="col">Date</th>
                                <th scope="col">Services</th>
                                <th scope="col">Attending Vet Tech</th>
                                <th scope="col">SOA #</th>
                            </thead>
                            <tbody id="surgery-list">

                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </section>
    
    <div class="modal fade" id="pets-modal" data-bs-backdrop="static">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <div class="modal-title">
                        <img src="../images/thefurrproject.PNG" alt="" class="img-fluid">
                    </div>
                    <button class="btn-close" data-bs-dismiss="modal">
                    </button>
                </div>
                <div class="modal-body">
                    <h3 class="fw-bold" id="client-name"></h3>
                    <hr>
                    <div class="table-responsive">
                        <table class="table table-striped">
                            <thead>
                                <th scope="col">Name</th>
                                <th scope="col">Breed</th>
                                <th scope="col">Species</th>
                                <th scope="col">Sex</th>
                                <th scope="col">Age</th>
                                <th scope="col">Action</th>
                            </thead>
                            <tbody id="pets-table">
                                
                            </tbody>
                        </table>
                    </div>

                    <div class="mt-3">
                        <h3 class="fw-bold">
                            Add New Pet
                        </h3>
                        <hr>
                        <input id="insert-pet-name" type="text" class="form-control" placeholder="Name">
                        <input id="insert-pet-breed" type="text" class="form-control mt-3" placeholder="Breed">
                        <input id="insert-pet-species" type="text" class="form-control mt-3" placeholder="Species">
                        <label class="mt-3">
                            Sex:
                        </label>
                        <select class="form-select" id="insert-pet-sex">
                            <option value="MALE">MALE</option>
                            <option value="FEMALE">FEMALE</option>
                        </select>
                        <label class="mt-3">
                            Birth Date:
                        </label>
                        <input id="insert-pet-birth-date" type="date" class="form-control mt-3">
                        <button class="mt-3 rounded-button" id="confirm-insert-pet">
                            Confirm
                        </button>
                        
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="initial-checkups-modal" data-bs-backdrop="static">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <div class="modal-title">
                        <img src="../images/thefurrproject.PNG" class="img-fluid" alt="">
                    </div>
                    <button class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="table-responsive">
                        <table class="table table-striped">
                            <thead>
                                <th scope="col">Medical History</th>
                                <th scope="col">Wellness/Behavior</th>
                                <th scope="col">Weight</th>
                                <th scope="col">Temp</th>
                                <th scope="col">HR</th>
                                <th scope="col">RR</th>
                                <th scope="col">Physical Exam</th>
                                <th scope="col">CC/HX</th>
                                <th scope="col">Dx Tools</th>
                                <th scope="col">TDX/DX/CASE</th>
                                <th scope="col">Treatment</th>
                                <th scope="col">In-Patient</th>
                                <th scope="col">Surgery</th>s
                                <th scope="col">Out-Patient</th>
                                <th scope="col">Take Home Meds/Rx</th>
                                <th scope="col">Date</th>
                            </thead>
                            <tbody id="initial-check-ups-table">

                            </tbody>
                        </table>
                    </div>
                    <div class="col-lg-7 mx-auto">
                        <h3 class="fw-bold mt-5">Add Initial Checkup Record</h3>
                        <label>Date</label>
                        <input id="checkup-date" type="date" class="form-control">
                        <input id="medical-history" type="text" class="form-control mt-3" placeholder="Medical History">
                        <input id="wellness" type="text" class="form-control mt-3" placeholder="Wellness/Behavior">
                        <input id="weight" type="text" class="form-control mt-3" placeholder="Weight">
                        <input id="temp" type="text" class="form-control mt-3" placeholder="Temp">
                        <input id="hr" type="text" class="form-control mt-3" placeholder="HR">
                        <input id="rr" type="text" class="form-control mt-3" placeholder="RR">
                        <input id="physical-exam" type="text" class="form-control mt-3" placeholder="Physical Exam">
                        <input id="cc-hx" type="text" class="form-control mt-3" placeholder="CC/Hx">
                        <input id="dx-tools" type="text" class="form-control mt-3" placeholder="Dx Tools">
                        <input id="tdx" type="text" class="form-control mt-3" placeholder="TDX/DX/Case">
                        <input id="treatment" type="text" class="form-control mt-3" placeholder="Treatment">
                        <label>In-Patient</label>
                        <select id="in-patient" class="form-select">
                            <option value="Yes">Yes</option>
                            <option value="No">No</option>
                        </select>
                        <label for="">Surgery</label>
                        <select id="surgery" class="form-select">
                            <option value="Yes">Yes</option>
                            <option value="No">No</option>
                        </select>
                        <label for="">Out-Patient</label>
                        <select id="out-patient" class="form-select">
                            <option value="Yes">Yes</option>
                            <option value="No">No</option>
                        </select>
                        <textarea id="take-home-meds" class="form-control mt-3" placeholder="Take Home Meds"></textarea>
                        <button id="confirm-insert-medical-record" class="rounded-outline-button mt-3">Confirm</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="wellness-record-modal" data-bs-backdrop="static">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <div class="modal-title">
                        <img src="../images/thefurrproject.PNG" alt="" class="img-fluid">
                    </div>
                    <button class="btn-close" data-bs-toggle="modal" data-bs-target="#pets-modal"></button>
                </div>
                <div class="modal-body">
                    <h4>Client's Name: <span class="fw-bold" id="records-client-name"></span></h4>
                    <h4>Pet's Name: <span class="fw-bold" id="records-pet-name"></span></h4>
                    <div class="table-responsive">
                        <table class="table table-striped">
                            <thead>
                                <th scope="col">Service</th>
                                <th scope="col">Pet Weight</th>
                                <th scope="col">Attending Vet</th>
                                <th scope="col">Remarks</th>
                                <th scope="col">Date</th>
                                <th scope="col">Next Appointment</th>						
                            </thead>
                            <tbody id="wellness-record-table">
    
                            </tbody>
                        </table>
                    </div>
                    
                    
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="edit-password-modal" data-bs-backdrop="static">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <div class="modal-title">
                        <img src="../images/thefurrproject.PNG" class="img-fluid" alt="">
                    </div>
                    <button class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div>
                        <input id="new-password" type="password" placeholder="New Password" class="form-control">
                        <div class="invalid-feedback" id="new-password-error"></div>
                    </div>
                    <div>
                        <input id="retype-new-password" type="password" placeholder="Retype New Password" class="form-control mt-3">
                        <div class="invalid-feedback" id="retype-new-password-error"></div>
                    </div>
                    
                    <button class="rounded-button mt-3" id="confirm-new-password">Confirm</button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" data-bs-backdrop="static" id="view-medical-records-modal">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <div class="modal-title">
                        <img src="../images/thefurrproject.PNG" alt="" class="img-fluid">
                    </div>
                    <button class="btn-close" data-bs-target="#pets-modal" data-bs-toggle="modal"></button>
                </div>
                <div class="modal-body">
                    <h3 id="medical-record-client-name"></h3>
                    <h3 id="medical-record-client-code"></h3>
                    <h3 id="medical-record-pet-name"></h3>
                    <div class="table-responsive">
                        <table class="table talbe-striped">
                            <thead>
                                <th scope="col">Weight</th>
                                <th scope="col">Temp</th>
                                <th scope="col">HR</th>
                                <th scope="col">RR</th>
                                <th scope="col">Tests</th>
                                <th scope="col">Procedure</th>
                                <th scope="col">Medication</th>
                                <th scope="col">Case Closed</th>
                                <th scope="col">Attending Vet</th>
                                <th scope="col">Attending Vet Nurse</th>
                                <th scope="col">Date</th>
                            </thead>
                            <tbody id="medical-records-table">

                            </tbody>
                        </table>
                        
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="view-lab-results-modal" data-bs-backdrop="static">
        <div class="modal-dialog moda-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <div class="modal-title">
                        <img src="../images/thefurrproject.PNG" class="img-fluid" alt="">
                    </div>
                    <button class="btn-close" data-bs-toggle="modal" data-bs-target="#create-patient-records-modal"></button>
                </div>
                <div class="modal-body">
                    <div class="sticky-top">
                        <p>Patient Name: <span class="fw-bold" id="lab-result-patient-name"></span></p>
                        <p>Lab Request: <span class="fw-bold" id="lab-result-lab-request"></span></p>
                        <p>Attending Vet: <span class="fw-bold" id="lab-result-attending-vet"></span></p>
                    </div>
                    <div id="lab-results-list">

                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="doctor-view-lab-results-modal" data-bs-backdrop="static">
        <div class="modal-dialog moda-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <div class="modal-title">
                        <img src="../images/thefurrproject.PNG" class="img-fluid" alt="">
                    </div>
                    <button class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="sticky-top bg-light rounded-2 p-2">
                        <p>Patient Name: <span class="fw-bold" id="doctor-lab-result-patient-name"></span></p>
                        <p>Lab Request: <span class="fw-bold" id="doctor-lab-result-lab-request"></span></p>
                        <p>Attending Vet: <span class="fw-bold" id="doctor-lab-result-attending-vet"></span></p>
                    </div>
                    <div id="doctor-lab-results-list">

                    </div>
                </div>
            </div>
        </div>
    </div>


    <div class="modal fade" data-bs-backdrop="static" id="soa-details-modal">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <div class="modal-title">
                        <img src="../images/thefurrproject.PNG" class="img-fluid" alt="">
                    </div>
                    <button class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body" id="print-me">
                    <div class="bg-light rounded-3 p-3" id="client-info">
                        <p>Client Name: <span class="fw-bold" id="soa-client-name"></span></p>
                        <p>Patient Name: <span class="fw-bold" id="soa-patient-name"></span></p>
                        <p>Client Code: <span class="fw-bold" id="soa-client-code"></span></p>
                        <br>
                        <p class="fw-bold" id="medication-rx">Medication/Rx:</p>
                        <p id="medication"></p>
                    </div>

                    <div class="table-responsive mt-5">
                        <table class="table table-striped">
                            <thead>
                                <th scope="col">Service</th>
                                <th scope="col">Base Price</th>
                                <th scope="col">Quantity</th>
                                <th scope="col">Amount</th>
                                <th scope="col">Amount(Discounted)</th>
                                <th scope="col">Discount</th>
                            </thead>
                            <tbody id="soa-details-table">
                                
                            </tbody>
                        </table>
                    </div>
                    <p id="total-amount-p">Total: &#8369 <span class="fw-bold" id="total-amount"></span></p>
                    <br>

                    <h5 class="fw-bold">Payment History</h5>
                    <div class="table-responsive">
                        <table class="table table-striped">
                            <thead>
                                <th scope="col">Amount</th>
                                <th scope="col">balance</th>
                            </thead>
                            <tbody id="payments-table">

                            </tbody>
                        </table>
                    </div>
                    <p class="text-center" id="footer">
                        <span class="fw-bold" id="attending-veterinarian">Attending Veterinarian</span><br>
                        <span id="soa-attending-vet"></span>
                    </p>
                    
                </div>
            </div>
        </div>

    </div>

    <div class="modal fade" id="enter-current-password-modal" data-bs-backdrop="static">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <div class="modal-title">
                        <img src="../images/thefurrproject.PNG" class="img-fluid" alt="">
                    </div>
                    <button class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div>
                        <input placeholder="Enter Current Password" type="password" id="current-password" class="form-control">
                        <div class="invalid-feedback" id="current-password-error">

                        </div>
                    </div>
                    
                    <button id="confirm-password" class="rounded-button mt-3">Confirm</button>
                </div>
            </div>
        </div>

    </div>

    <div class="modal fade" data-bs-backdrop="static" id="client-booking-modal">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <div class="modal-title">
                        <img src="../images/thefurrproject.PNG" class="img-fluid" alt="">
                    </div>
                    <button class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div id="client-pets-list">

                    </div>

                    <button class="rounded-button mt-3" id="confirm-book">
                        <span class="spinner-border spinner-border-sm" id="confirm-book-spinner"></span><span class="ms-3">Book</span>
                    </button>
                </div>
            </div>
        </div>

    </div>
    
    


    <div class="modal fade" id="create-patient-records-modal" data-bs-backdrop="static">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <div class="modal-title">
                        <img class="img-fluid" src="../images/thefurrproject.PNG" alt="">
                    </div>
                    <button class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    
                    
                    <div id="patient-details" class="sticky-top bg-light p-3">
                        <p>Client Name: <span id="patient-owner-name" class="fw-bold"></span></p>
                        <p>Patient Name: <span id="patient-name" class="fw-bold"></span></p>
                        <p>Client Code: <span id="client-code" class="fw-bold"></span></p>
                    </div>

                    <div class="card mt-2 rounded-4 shadow">
                        <div class="card-header">
                            <h3 class="text-center fw-bold">LABORATORY REQUEST <span><button id="refresh-lab-requests" class="btn btn-outline-primary"><span id="refresh-spinner" class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span><span>Refresh</span></button></h3>
                        </div>
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table table-striped">
                                    <thead>
                                        <th scope="col">Date and Time</th>
                                        <th scope="col">Time Limit (min)</th>
                                        <th scope="col">Request</th>
                                        <th scope="col">Attending Vet Tech</th>
                                        <th scope="col">Attending Vet</th>
                                        <th scope="col">Result</th>
                                    </thead>
                                    <tbody id="lab-request-table">
        
                                    </tbody>
                                </table>
                            </div>
                            
                            <div class="dropdown">
                                <button id="choose-vet-tech" class="rounded-button dropdown-toggle" data-bs-toggle="dropdown">Choose Vet Tech</button>
                                <ul class="dropdown-menu" id="vet-tech-list">
                                    
                                </ul>
                            </div>
                            <div>
                                <textarea id="lab-request" class="form-control mt-3" placeholder="Enter Lab Request Here"></textarea>
                                <div class="invalid-feedback" id="lab-request-error"></div>
                            </div>
                            
                            <div>
                                <input id="time-limit" type="number" placeholder="Set Time Limit in minutes" class="form-control mt-3">
                                <div class="invalid-feedback" id="time-limit-error"></div>
                            </div>
                            
                            <button class="rounded-button mt-3" id="confirm-lab-request">Submit Lab Request</button>
                        </div>
                    </div>

                    <div class="card shadow rounded-4 mt-5">
                        <div class="card-header">
                            <h3 class="text-center fw-bold">
                                STATEMENT OF ACCOUNTS
                            </h3>
                            <p class="text-center"><em>Data inputted here will be recorded as history of services renderred by the attending Vet/attending Vet Tech</em></p>
                        </div>
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table table-striped">
                                    <thead>
                                        <th scope="col">Service</th>
                                        <th scope="col">Base Price</th>
                                        <th scope="col">Quantity</th>
                                        <th scope="col">Total Price</th>
                                        <th scope="col">Discount(%)</th>
                                    </thead>
                                    <tbody id="soa-table">
        
                                    </tbody>
                                </table>
                            </div>
                            <div class="dropdown">
                                <button id="choose-service" class="rounded-outline-button dropdown-toggle" data-bs-toggle="dropdown">
                                    Choose Service
                                </button>
                                <ul class="dropdown-menu" id="services-list">
                                    
                                </ul>
                            </div>

                            <div class="dropdown mt-3">
                                <button class="rounded-outline-button dropdown-toggle" id="service-attending-lab-tech" data-bs-toggle="dropdown">Choose Attending Vet Tech</button>
                                <ul class="dropdown-menu" id="service-attending-lab-tech-list">

                                </ul>
                            </div>
                            
                            <div>
                                <input type="number" placeholder="Base Price" id="base-price" class="mt-3 form-control">
                                <div class="invalid-feedback">
                                    Please fill out this field.
                                </div>
                            </div>
                            <div>
                                <input type="number" placeholder="Quantity" id="quantity" class="mt-3 form-control">
                                <div class="invalid-feedback">
                                    Please fill out this field
                                </div>
                            </div>
                            <button class="rounded-outline-button mt-3" id="confirm-service">Confirm Service</button>


                            <h4 class="fw-bold text-center mt-5">
                                Custom Service
                            </h4>
                            <div>
                                <input type="text" placeholder="Custom Service" id="custom-service" class="mt-2 form-control">
                                <div class="invalid-feedback">
                                    Please fill out this field.
                                </div>
                            </div>

                            <div class="dropdown mt-3">
                                <button class="rounded-outline-button dropdown-toggle" id="custom-service-attending-lab-tech" data-bs-toggle="dropdown">Choose Attending Vet Tech</button>
                                <ul class="dropdown-menu" id="custom-service-attending-lab-tech-list">

                                </ul>
                            </div>

                            

                            <select id="custom-service-category" class="mt-3 form-select">
                                <option value="laboratory">Laboratory</option>
                                <option value="emergency">Emergency</option>
                                <option value="surgery">Surgery</option>
                            </select>

                            <div>
                                <input type="number" placeholder="Base Price" id="custom-base-price" class="mt-3 form-control">
                                <div class="invalid-feedback">
                                    Please fill out this field.
                                </div>
                            </div>
                            <div>
                                <input type="number" placeholder="Quantity" id="custom-quantity" class="mt-3 form-control">
                                <div class="invalid-feedback">
                                    Please fill out this field
                                </div>
                            </div>
                            <button class="rounded-outline-button mt-3" id="confirm-custom-service">Confirm Custom Service</button>
                        </div>
                        <div class="card-footer">
                            <button class="rounded-button" id="submit-soa">Submit SOA</button>
                        </div>
                    </div>

                    <div class="card rounded-4 shadow mt-5">
                        <div class="card-header">
                            <h3 class="fw-bold text-center">PATIENT'S MEDICAL RECORD</h3>
                        </div>
                        <div class="card-body">
                            <div class="form-floating">
                                <input id="medical-record-weight" type="text" placeholder="Weight" class="form-control mt-3">
                                <label>Weight</label>
                            </div>
                            
                            <div class="form-floating">
                                <input id="medical-record-temp" type="text" placeholder="Temp" class="form-control mt-3">
                                <label>Temp</label>
                            </div>
                            <div class="form-floating">
                                <input id="medical-record-hr" type="text" placeholder="HR" class="form-control mt-3">
                                <label>HR</label>
                            </div>
                            <div class="form-floating">
                                <input id="medical-record-rr" type="text" placeholder="RR" class="form-control mt-3">
                                <label>RR</label>
                            </div>
                            
                            <div class="form-floating">
                                <textarea id="medical-record-tests" class="form-control mt-3" placeholder="Tests"></textarea>
                                <label>Tests</label>
                            </div>
                            <div class="form-floating">
                                <textarea id="medical-record-procedures" class="form-control mt-3" placeholder="Procedures"></textarea>
                                <label>Procedures</label>
                            </div>
                            <div class="form-floating">
                                <textarea id="medical-record-medication" class="form-control mt-3" placeholder="Medication/RX"></textarea>
                                <label>Medication/RX</label>
                            </div>
                            <!-- <button class="rounded-button w-100 mt-3">Print Medication/RX</button> -->
                            
                            
        
                            <label class="mt-3">Case Closed</label>
                            <select id="medical-record-case-closed" class="form-select mt-3">
                                <option value="Yes">Yes</option>
                                <option value="Yes">No</option>
                            </select>
                            <label class="mt-3">Next Appointment:</label>
                            <input id="medical-record-next-appointment" type="date" class="form-control">
        
                            <label class="mt-3">Attending Vet Nurse:</label>
                            <select class="form-select" id="choose-vet-assistant">
                                
                            </select>
                            

                            <div class="form-floating">
                                <textarea class="form-control mt-3" type="text" id="medical-record-service" placeholder="Service"></textarea>
                                <label>Service</label>
                            </div>

                            <div class="form-floating">
                                <textarea class="form-control mt-3" id="medical-record-remarks" placeholder="Remarks"></textarea>
                                <label>Remarks</label>
                            </div>
                            
                           
                            <button id="medical-record-confirm" class="rounded-button mt-3">Confirm</button>
                        </div>
                    </div>
                    
                </div>
            </div>
        </div>
    </div>


    <section id="confinement-section">
        <div class="container">
            <div class="card shadow col-lg-6 mx-auto mt-5 rounded-3">
                <div class="card-header">
                    <h3 class="fw-bold">
                        Confinement
                    </h3>
                </div>
                <div class="card-body">
                    <table class="table table-striped">
                        <thead>
                            <th scope="col">Name</th>
                            <th scope="col">Action</th>
                        </thead>
                        <tbody id="confined-pets-table">

                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </section>


    <div class="modal fade" data-bs-backdrop="static" id="view-confinement-details-modal">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <div class="modal-title">
                        <img src="../images/thefurrproject.PNG" class="img-fluid" alt="">
                    </div>
                    
                    <button class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <p></p>Client Name: <span class="fw-bold" id="confinement-client-name"></span><br>
                    Contact Number: <span class="fw-bold" id="confinement-contact"></span><br>
                    Pet Name: <span class="fw-bold" id="confinement-pet-name"></span><br>
                    Species: <span class="fw-bold" id="confinement-species"></span><br>
                    Breed: <span class="fw-bold" id="confinement-breed"></span><br>
                    Date of Birth: <span class="fw-bold" id="confinement-birthdate"></span><br>
                    Sex: <span class="fw-bold" id="confinement-sex"></span><br>
                    Type of Fluid: <span class="fw-bold" id="confinement-type-of-fluid"></span><br>
                    Drip Rate/Ratio: <span class="fw-bold" id="confinement-drip-rate"></span><br>
                    Duration of Fluid Therapy/Day: <span class="fw-bold" id="confinement-duration-of-fluid"></span><br>
                    Temp./Def. Diagnosis: <span class="fw-bold" id="confinement-temp-def"></span></p>

                    <div class="table-responsive">
                        <table class="table table-striped">
                            <thead>
                                <th scope="col">Status</th>
                                <th scope="col">Date</th>
                            </thead>
                            <tbody id="confinement-status-table">

                            </tbody>
                        </table>
                    </div>

                    <h5 class="mt-3 fw-bold">
                        Add Status
                    </h3>
                    <hr>
                    <div>
                        <input type="text" id="add-confinement-status" placeholder="Add Confinement Status" class="form-control">
                        <div class="invalid-feedback" id="add-confinement-status-error">

                        </div>
                    </div>
                    
                    <button class="rounded-button mt-3" id="confirm-add-confinement-status">Confirm</button>
                </div>
            </div>
        </div>
    </div>

    <div id="loading-screen">
        <div class="card rounded-3 shadow">
            <div class="card body p-5">
                <span class="spinner-border text-primary"></span>
            </div>
        </div>
    </div>
</body>
</html>